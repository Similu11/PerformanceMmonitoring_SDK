{"version":3,"file":"collectinfo.umd.js","sources":["../src/typings/types.ts","../src/data/constants.ts","../src/data/reportData.ts","../src/config/index.ts","../src/data/analyticsTracker.ts","../src/error/index.ts","../src/helpers/getNetworkInformation.ts","../src/helpers/isLowEnd.ts","../src/helpers/onVisibilityChange.ts","../src/helpers/utils.ts","../src/helpers/vitalsScore.ts","../src/data/reportPerf.ts","../src/helpers/getNavigatorInfo.ts","../src/data/log.ts","../src/data/metrics.ts","../src/performance/cumulativeLayoutShift.ts","../src/performance/observeInstances.ts","../src/performance/performanceObserver.ts","../src/performance/firstInput.ts","../src/performance/totalBlockingTime.ts","../src/performance/paint.ts","../src/performance/resourceTiming.ts","../src/performance/observe.ts","../src/data/storageEstimate.ts","../src/collectinfo.ts","../src/tools/isSupported.ts","../src/performance/getNavigationTiming.ts","../src/helpers/isSupported.ts"],"sourcesContent":["/**\r\n * @param isResourceTiming  - æ˜¯å¦å¼€å¯èµ„æºæ•°æ®\r\n * @param isElementTiming - æ˜¯å¦å¼€å¯æ€§èƒ½æ•°æ®\r\n * @param analyticsTracker - è‡ªå®šä¹‰åˆ†æå·¥å…·\r\n * @param analyticsTracker - voidæ–¹æ³•å‚æ•°IAnalyticsTrackerOptions\r\n * @param maxTime  - æœ€å¤§è¯·æ±‚æ—¶é—´\r\n * @interface ç³»ç»Ÿé…ç½®æ¥å£\r\n */\r\n\r\nexport type IYidengData = | number | IYidengNavigationTiming | IYidengNetworkInformation;\r\n\r\nexport type IVitalsScore = 'good' | 'needsImprovement' | 'poor' | null;\r\n\r\nexport type EffectiveConnectionType = | '2g' | '3g' | '4g' | '5g' | 'slow-2g' | 'lte';\r\n\r\n//æ€§èƒ½æŒ‡æ ‡å…·ä½“è¯·æ±‚ç±»å‹\r\nexport type IPerformanceEntryInitiatorType =\r\n    | 'beacon'\r\n    | 'css'\r\n    | 'fetch'\r\n    | 'img'\r\n    | 'other'\r\n    | 'script'\r\n    | 'xmlhttprequest';\r\n\r\n//æ€§èƒ½æŒ‡æ ‡å‚æ•°\r\nexport type IPerformanceObserverType =\r\n    | 'first-input'\r\n    | 'largest-contentful-paint'\r\n    | 'layout-shift'\r\n    | 'longtask'\r\n    | 'measure'\r\n    | 'navigation'\r\n    | 'paint'\r\n    | 'element'\r\n    | 'resource';\r\n\r\nexport interface IReportData {\r\n    sendToAnalytics(level: AskPriority, body: string | object, url: string): void;\r\n}\r\n\r\nexport interface IYidengOptions {\r\n    captureError?: boolean; //æ•è·é”™è¯¯\r\n    resourceTiming?: boolean; //èµ„æºå®šæ—¶\r\n    elementTiming?: boolean; //å…ƒç´ \r\n    //åˆ†æå™¨\r\n    analyticsTracker?: (options: IAnalyticsTrackerOptions) => void;\r\n    //æ—¥å¿—\r\n    maxMeasureTime?: number; //æœ€å¤§æµ‹é‡æ—¶é—´\r\n    logUrl?: string;\r\n    rrwebUrl?: string;\r\n    permaceUrl: string;\r\n    isRrweb?:boolean; //æ˜¯å¦å¼€å¯å½•åˆ¶\r\n    module?:string;\r\n}\r\n\r\nexport interface IAnalyticsTrackerOptions {\r\n    module?:string;\r\n    metricName: string;  //æŒ‡æ ‡åç§°\r\n    data: IYidengData;\r\n    eventProperties: object;\r\n    navigatorInformation: INavigatorInfo;\r\n    vitalsScore: IVitalsScore;\r\n}\r\n\r\n\r\nexport interface INavigatorInfo {\r\n    deviceMemory?: number;\r\n    hardwareConcurrency?: number;\r\n    isLowEndDevice?: boolean;\r\n    isLowEndExperience?: boolean;\r\n    serviceWorkerStatus?: 'controlled' | 'supported' | 'unsupported';\r\n}\r\n\r\nexport interface IYidengNetworkInformation {\r\n    downlink?: number;\r\n    effectiveType?: EffectiveConnectionType;\r\n    onchange?: () => void;\r\n    rtt?: number;\r\n    saveData?: boolean;\r\n}\r\n\r\nexport interface IYidengNavigationTiming {\r\n    fetchTime?: number;\r\n    workerTime?: number;\r\n    totalTime?: number;\r\n    downloadTime?: number;\r\n    timeToFirstByte?: number;\r\n    headerSize?: number;\r\n    dnsLookupTime?: number;\r\n    tcpTime?: number;\r\n    whiteTime?: number;\r\n    domTime?: number;\r\n    loadTime?: number;\r\n    parseDomTime?: number;\r\n}\r\n\r\nexport interface IYidengConfig {\r\n    reportData: IReportData;\r\n    isResourceTiming: boolean;\r\n    isElementTiming: boolean;\r\n    analyticsTracker?: (options: IAnalyticsTrackerOptions) => void;\r\n    logUrl: string;\r\n    maxTime: number;\r\n    isRrweb:boolean;\r\n    rrwebUrl:string;\r\n    permaceUrl:string;\r\n    module:string;\r\n}\r\n\r\n//æ¶ˆè€—æ—¶é—´ç±»å‹\r\nexport interface IYidengDataConsumption {\r\n    beacon: number;\r\n    css: number;\r\n    fetch: number;\r\n    img: number;\r\n    other: number;\r\n    script: number;\r\n    total: number;\r\n    xmlhttprequest: number;\r\n}\r\n\r\n//åº¦é‡æŒ‡æ ‡æ•°æ®\r\nexport interface IMetricMap {\r\n    [measureName: string]: boolean;\r\n}\r\n\r\nexport declare interface IPerformanceEntry {\r\n    decodedBodySize?: number;\r\n    duration: number;\r\n    entryType: IPerformanceObserverType;\r\n    initiatorType?: IPerformanceEntryInitiatorType;\r\n    loadTime: number;\r\n    name: string;\r\n    renderTime: number;\r\n    startTime: number;\r\n    hadRecentInput?: boolean;\r\n    value?: number;\r\n    identifier?: string;\r\n}\r\n\r\nexport interface IPerfObservers {\r\n    [measureName: string]: any;\r\n}\r\n\r\n// https://wicg.github.io/event-timing/#sec-performance-event-timing\r\nexport interface PerformanceEventTiming extends PerformanceEntry {\r\n    processingStart: DOMHighResTimeStamp;\r\n    target?: Node;\r\n}\r\n//è¯·æ±‚å“åº”ä¼˜å…ˆçº§\r\nexport enum AskPriority {\r\n    URGENT = 1, //ç´§æ€¥çš„\r\n    IDLE = 2,  //é—²ç½®çš„\r\n}","interface Navigator{\r\n    estimated:any;\r\n    storage: any;\r\n    deviceMemory?: number;\r\n    hardwareConcurrency?: number;\r\n    connection?: string;\r\n    effectiveType?: string;\r\n    serviceWorker?: {\r\n        controller?: string;\r\n    };\r\n    sendBeacon?: any;\r\n}\r\nexport const W = window;\r\nexport const C = W.console;\r\nexport const D = document;\r\nexport const WN = (W.navigator as unknown) as Navigator; //è·å–ç”¨æˆ·æµè§ˆå™¨ä¿¡æ¯\r\nexport const WP = W.performance; //Performance APIå…è®¸ç½‘é¡µè®¿é—®æŸäº›å‡½æ•°æ¥æµ‹é‡ç½‘é¡µå’ŒWebåº”ç”¨ç¨‹åºçš„æ€§èƒ½\r\n//å†…å­˜\r\nexport const getDM = () => WN.deviceMemory ?? 0;\r\n//cpuæ ¸æ•°\r\nexport const getHC = () => WN.hardwareConcurrency ?? 0;\r\n","import { AskPriority, IReportData } from \"../typings/types\";\r\nimport { W, WN } from './constants';\r\nimport { config } from '../config';\r\n//ä¸ŠæŠ¥å·¥å…·\r\ntype TrackerOptions = {\r\n    logUrl: string;\r\n}\r\n\r\nclass ReportData implements IReportData {\r\n    private logUrl: string;\r\n    constructor(options: TrackerOptions) {\r\n        const { logUrl } = options;\r\n        if (logUrl) {\r\n            this.logUrl = logUrl;\r\n        } else {\r\n            throw new Error('è¯·ä¼ é€’è¦è®°å½•æ•°æ®çš„è·¯ç”±æ¥å£');\r\n        }\r\n    }\r\n\r\n    public sendToAnalytics(level: AskPriority, body: string | object, url: string) {\r\n        if (url) {\r\n            this.logUrl = url; //ä¸´æ—¶æ›´æ¢å…¶ä»–URL\r\n        }\r\n        let logurl = this.logUrl;\r\n        if (level == AskPriority.URGENT) {\r\n            //ç´§æ€¥æ—¥å¿—\r\n            if (!!W.fetch) {\r\n                fetch(logurl, {\r\n                    headers: {\r\n                        'module': config.module.toString()\r\n                    }, body: body.toString(), method: 'POST', keepalive: true\r\n                }); // fetchæ–¹æ³•ä¼˜å…ˆçº§æœ€é«˜\r\n            } else {\r\n                let xhr: XMLHttpRequest | null = new XMLHttpRequest();\r\n                // è®¾ç½®è¯·æ±‚å¤´\r\n                xhr.setRequestHeader('Content-Type', 'application/json');\r\n                xhr.setRequestHeader('module', config.module.toString());\r\n                xhr.send(body.toString()); // å‘é€å‚æ•°\r\n                xhr.onload = function (e) {\r\n                    //åŠæ—¶æ¸…ç†ä»¥é˜²å¤šæ¬¡åˆ›å»º\r\n                    xhr = null;\r\n                }\r\n            }\r\n        } else if (level == AskPriority.IDLE) {\r\n            if (!!WN.sendBeacon) {\r\n                navigator.sendBeacon(logurl, body.toString()); //sendBeacon()æ–¹æ³•ä¼šä½¿ç”¨æˆ·ä»£ç†åœ¨æœ‰æœºä¼šæ—¶å¼‚æ­¥åœ°å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼ŒåŒæ—¶ä¸ä¼šå»¶è¿Ÿé¡µé¢çš„å¸è½½æˆ–å½±å“ä¸‹ä¸€å¯¼èˆªçš„è½½å…¥æ€§èƒ½\r\n            } else {\r\n                let img: HTMLImageElement | null = new Image();\r\n                img.src = `${logurl}?body=${body}`;\r\n                img.onload = function () {\r\n                    img = null; //ç»Ÿè®¡å®Œæˆæ”¶å›åˆ›å»ºçš„å…ƒç´ é˜²æ­¢å†…å­˜æ³„éœ²\r\n                };\r\n            }\r\n        }\r\n    }\r\n}\r\nexport default ReportData;","import ReportData from \"../data/reportData\";\r\nimport { IYidengConfig, IReportData } from \"../typings/types\";\r\n\r\nexport const config: IYidengConfig = {\r\n    logUrl:\"\",\r\n    reportData: new ReportData({ logUrl: 'hole' }),\r\n    isResourceTiming: false,\r\n    isElementTiming: false,\r\n    maxTime: 15000,\r\n    isRrweb:true,\r\n    rrwebUrl:\"\",\r\n    permaceUrl:\"\",\r\n    module:''\r\n}","//åˆ†æå™¨\r\nimport { IAnalyticsTrackerOptions, AskPriority } from \"../typings/types\";\r\nimport { config } from \"../config\";\r\nconst analyticsTracker = (options: IAnalyticsTrackerOptions): void => {\r\n    const {\r\n        metricName,\r\n        eventProperties,\r\n        data,\r\n        navigatorInformation,\r\n        vitalsScore\r\n    } = options;\r\n    options.module = config.module;\r\n    config.reportData.sendToAnalytics(AskPriority.IDLE, options, config.permaceUrl);//ä¸Šä¼ æ€§èƒ½æŒ‡æ ‡\r\n};\r\nexport default analyticsTracker;","import { config } from '../config';\r\nimport { W } from '../data/constants';\r\n//rrwebåœ¨è¿™é‡Œå¼•å…¥\r\nimport { record, pack } from 'rrweb';\r\nimport { AskPriority } from '../typings/types';\r\ntype ErrorInfo = {};\r\n\r\nclass ErrorTrace {\r\n    private errordefo: ErrorInfo;\r\n    private eventsMatrix: Array<[]>;\r\n    constructor() {\r\n        this.errordefo = {};\r\n        this.eventsMatrix = [[]];\r\n    }\r\n    //å…¨å±€æ•è·åŒæ­¥+å¼‚æ­¥é”™è¯¯\r\n    private globalError() {\r\n        W.onerror = (\r\n            eventOrMessage: Event | string,\r\n            scriptURL?: string,\r\n            lineno?: number,\r\n            colno?: number,\r\n            error?: Error\r\n        ): boolean => {\r\n            const errorInfo = JSON.stringify({\r\n                scriptURL,\r\n                lineno,\r\n                colno,\r\n                error,\r\n                module: config.module\r\n            });\r\n            //é€šè¿‡é”™è¯¯ä¿¡æ¯è¿˜åŸsourcemapæºæ–‡ä»¶åœ°å€\r\n            config.reportData.sendToAnalytics(AskPriority.URGENT, errorInfo, config.logUrl);\r\n            const len = this.eventsMatrix.length;\r\n            let events = [];\r\n            if (len > 1) {\r\n                events = this.eventsMatrix[len - 2].concat(this.eventsMatrix[len - 1]);\r\n            } else {\r\n                events = this.eventsMatrix[0];\r\n            }\r\n            const body = JSON.stringify({ events, module: config.module });\r\n            config.reportData.sendToAnalytics(AskPriority.IDLE, body, config.rrwebUrl);\r\n            this.eventsMatrix = [[]];\r\n            this.recordPage();\r\n            return true;\r\n        }\r\n    }\r\n\r\n    //èµ„æºæŒ‚è½½å¤±è´¥ å¦‚404png\r\n    private networkError() {\r\n        W.addEventListener('error', function (e: ErrorEvent) {\r\n            if (e.target !== W) {\r\n                console.log('ç½‘ç»œé”™è¯¯', e.target);\r\n                //è¿™é‡Œçœ‹æ˜¯å¦éœ€è¦ä¸ŠæŠ¥ï¼Œèµ„æº404æ˜¯å¦éœ€è¦ä¸ŠæŠ¥\r\n            }\r\n        }, true);\r\n    }\r\n\r\n    //å¼‚æ­¥Promiseé”™è¯¯\r\n    private promiseError() {\r\n        W.addEventListener('unhandledrejection', function (e) {\r\n            e.preventDefault();\r\n            console.log('promiseError', e.reason);\r\n            return true;\r\n        })\r\n    }\r\n\r\n    //iframeåŠ è½½é”™è¯¯\r\n    private iframeError() {\r\n        const frames = W.frames;\r\n        for (let i = 0; i < frames.length; i++) {\r\n            frames[i].addEventListener('error', (e) => {\r\n                console.log('iframeåŠ è½½é”™è¯¯', e);\r\n            }, true);\r\n            frames[i].addEventListener('unhandledrejection', function (e) {\r\n                console.log('iframeé”™è¯¯_unhandledrejection', e);\r\n            }, true)\r\n        }\r\n    }\r\n\r\n    private consoleReflect() {\r\n        const console_error = W.console.error;\r\n        W.console.error = function () {\r\n            // config.reportData.sendToAnalytics(AskPriority.IDLE, 'console_error','');\r\n            // console_error.apply(window, arguments);\r\n        };\r\n    }\r\n\r\n    private recordPage() {\r\n        if (config.isRrweb) {\r\n            let eventsMatrix = this.eventsMatrix;\r\n            record({\r\n                emit(event: never, isCheckout) {\r\n                    // isCheckout æ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œå‘Šè¯‰ä½ é‡æ–°åˆ¶ä½œäº†å¿«ç…§\r\n                    if (isCheckout) {\r\n                        eventsMatrix.push([]);\r\n                    }\r\n                    const lastEvents = eventsMatrix[eventsMatrix.length - 1];\r\n                    lastEvents.push(event);\r\n                },\r\n                checkoutEveryNth: 10, // æ¯ 10 ä¸ª event é‡æ–°åˆ¶ä½œå¿«ç…§\r\n                packFn: pack,\r\n            });\r\n        }\r\n    }\r\n    public run() {\r\n        this.networkError();\r\n        //è§¦å‘å…¨ä½“æ•°æ®ç›‘å¬é”™è¯¯\r\n        this.globalError();\r\n        //è§¦å‘promiseçš„é”™è¯¯\r\n        this.promiseError();\r\n        this.recordPage();\r\n    }\r\n}\r\n\r\nexport default ErrorTrace;","import { WN } from '../data/constants';\r\nimport {\r\n    EffectiveConnectionType,\r\n    IYidengNetworkInformation,\r\n} from '../typings/types';\r\n\r\nexport let et: EffectiveConnectionType = '4g';\r\nexport let sd = false;\r\n\r\nexport const getNetworkInformation = (): IYidengNetworkInformation => {\r\n    //è·å–ç”¨æˆ·ç½‘é€Ÿ\r\n    if ('connection' in WN) {\r\n        const dataConnection = (WN as any).connection;\r\n        if (typeof dataConnection !== 'object') {\r\n            return {};\r\n        }\r\n        et = dataConnection.effectiveType;\r\n        sd = !!dataConnection.saveData;\r\n        return {\r\n            downlink: dataConnection.downlink,\r\n            effectiveType: dataConnection.effectiveType,\r\n            rtt: dataConnection.rtt,\r\n            saveData: !!dataConnection.saveData,\r\n        };\r\n    }else{\r\n        // è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¤šæ™®å‹’æµ‹é€Ÿæ³•æˆ–è€…ç›´æ¥ç”¨å›¾ç‰‡æ¢æµ‹æ³•\r\n    }\r\n    return {};\r\n}","import { getDM, getHC } from '../data/constants';\r\nimport { EffectiveConnectionType } from '../typings/types';\r\n\r\nexport const getIsLowEndDevice = (): boolean => {\r\n    //å¦‚æœå¯è¿è¡Œçº¿ç¨‹çš„é€»è¾‘å¤„ç†å™¨æ•°<=4\r\n    if (getHC() && getHC() <= 4) {\r\n        return true;\r\n    }\r\n\r\n    //å¦‚æœRAMå®¢æˆ·ç«¯è®¾å¤‡çš„è¿‘ä¼¼æ•°é‡å°äºç­‰äº4\r\n    if (getDM() && getDM() <= 4) {\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nexport const getIsLowEndExperience = (\r\n    et: EffectiveConnectionType,\r\n    sd: boolean,\r\n): boolean => {\r\n    //å¦‚æœè¿æ¥çš„æœ‰æ•ˆç±»å‹ä¸º 'slow-2g', '2g', '3g', or '4g' is !== 4g\r\n    switch (et) {\r\n        case 'slow-2g':\r\n            return true;\r\n            break;\r\n        case '2g':\r\n            return true;\r\n            break;\r\n        case '3g':\r\n            return true;\r\n            break;\r\n        default:\r\n            // æ•°æ®ä¿å­˜ç¨‹åºé¦–é€‰é¡¹\r\n            return getIsLowEndDevice() || sd;\r\n    }\r\n}\r\n","import { D } from '../data/constants';\r\n\r\nexport const visibility = {\r\n    isHidden: false,\r\n};\r\n/**\r\n * \r\n * ä»visibilitychange listenerï¼Œå®ƒä»…åœ¨é¡µé¢éšè—æ—¶ä¿å­˜ï¼Œå› ä¸ºåœ¨å‘é€è®¡æ—¶æˆ–è®°å½•æ—¶ï¼Œä¸è¦ä½¿ç”¨é”™è¯¯çš„â€œéšè—â€å€¼å¾ˆé‡è¦ã€‚\r\n */\r\nexport const didVisibilityChange = function (cb: Function) {\r\n    if (D.hidden) {\r\n        cb();\r\n        visibility.isHidden = D.hidden;\r\n    }\r\n};","import { W } from '../data/constants';\r\n\r\nexport const roundByTwo = (num: number) => {\r\n    return parseFloat(num.toFixed(2));\r\n};\r\n\r\nexport const convertToKB = (bytes: number): number | null => {\r\n    if (typeof bytes !== 'number') {\r\n        return null;\r\n    }\r\n    return roundByTwo(bytes / Math.pow(1024, 2));\r\n};\r\n\r\n/**\r\n * æ¨é€ä»»åŠ¡è‡³ requestIdleCallback\r\n * window.requestIdleCallback()æ–¹æ³•æ’å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æœŸè¢«è°ƒç”¨ã€‚\r\n * è¿™ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ï¼Œå¦‚åŠ¨ç”»å’Œè¾“å…¥å“åº”ã€‚\r\n * å‡½æ•°ä¸€èˆ¬ä¼šæŒ‰å…ˆè¿›å…ˆè°ƒç”¨çš„é¡ºåºæ‰§è¡Œï¼Œç„¶è€Œï¼Œå¦‚æœå›è°ƒå‡½æ•°æŒ‡å®šäº†æ‰§è¡Œè¶…æ—¶æ—¶é—´timeoutï¼Œåˆ™æœ‰å¯èƒ½ä¸ºäº†åœ¨è¶…æ—¶å‰æ‰§è¡Œå‡½æ•°è€Œæ‰“ä¹±æ‰§è¡Œé¡ºåºã€‚\r\n * å¼ºçƒˆå»ºè®®ä½¿ç”¨timeouté€‰é¡¹è¿›è¡Œå¿…è¦çš„å·¥ä½œï¼Œå¦åˆ™å¯èƒ½ä¼šåœ¨è§¦å‘å›è°ƒä¹‹å‰ç»è¿‡å‡ ç§’é’Ÿ \r\n*/\r\n\r\nexport const pushTask = (cb: any): void => {\r\n    if ('requestIdleCallback' in W) {\r\n        (W as any).requestIdleCallback(cb, { timeout: 3000 });\r\n    } else {\r\n        cb();\r\n    }\r\n};","import { IYidengData, IVitalsScore } from '../typings/types';\r\n/**https://web.dev/vitals/\r\n * Web æŒ‡æ ‡æ˜¯ Google å¼€åˆ›çš„ä¸€é¡¹æ–°è®¡åˆ’\r\n * TTFB æ˜¯è¡¡é‡èµ„æºè¯·æ±‚ä¸å“åº”çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹åˆ°è¾¾ä¹‹é—´çš„æ—¶é—´çš„åº¦é‡\r\n * FP é¦–æ¬¡ç»˜åˆ¶\r\n * FMP é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶\r\n * TTI äº¤äº’æ—¶é—´ (æ€§èƒ½åˆ†æç‚¹)\r\n * FCP(é¦–æ¬¡å†…å®¹ç»˜åˆ¶) æŒ‡æ ‡æµ‹é‡é¡µé¢ä»å¼€å§‹åŠ è½½åˆ°é¡µé¢å†…å®¹çš„ä»»ä½•éƒ¨åˆ†åœ¨å±å¹•ä¸Šå®Œæˆæ¸²æŸ“çš„æ—¶é—´ã€‚\r\n * LCP(æœ€å¤§å†…å®¹ç»˜åˆ¶) æŒ‡æ ‡ä¼šæ ¹æ®é¡µé¢é¦–æ¬¡å¼€å§‹åŠ è½½çš„æ—¶é—´ç‚¹æ¥æŠ¥å‘Šå¯è§†åŒºåŸŸå†…å¯è§çš„æœ€å¤§å›¾åƒæˆ–æ–‡æœ¬å—å®Œæˆæ¸²æŸ“çš„ç›¸å¯¹æ—¶é—´\r\n * FID æµ‹é‡ä»ç”¨æˆ·ç¬¬ä¸€æ¬¡ä¸é¡µé¢äº¤äº’ï¼ˆä¾‹å¦‚å½“ä»–ä»¬å•å‡»é“¾æ¥ã€ç‚¹æŒ‰æŒ‰é’®æˆ–ä½¿ç”¨ç”± JavaScript é©±åŠ¨çš„è‡ªå®šä¹‰æ§ä»¶ï¼‰ç›´åˆ°æµè§ˆå™¨å¯¹äº¤äº’ä½œå‡ºå“åº”ï¼Œå¹¶å®é™…èƒ½å¤Ÿå¼€å§‹å¤„ç†äº‹ä»¶å¤„ç†ç¨‹åºæ‰€ç»è¿‡çš„æ—¶é—´\r\n * TTI æŒ‡æ ‡æµ‹é‡é¡µé¢ä»å¼€å§‹åŠ è½½åˆ°ä¸»è¦å­èµ„æºå®Œæˆæ¸²æŸ“ï¼Œå¹¶èƒ½å¤Ÿå¿«é€Ÿã€å¯é åœ°å“åº”ç”¨æˆ·è¾“å…¥æ‰€éœ€çš„æ—¶é—´\r\n * TBT (æ€»é˜»å¡æ—¶é—´) æŒ‡æ ‡æµ‹é‡First Contentful Paint é¦–æ¬¡å†…å®¹ç»˜åˆ¶ (FCP)ä¸Time to Interactive å¯äº¤äº’æ—¶é—´ (TTI)ä¹‹é—´çš„æ€»æ—¶é—´ï¼Œè¿™æœŸé—´ï¼Œä¸»çº¿ç¨‹è¢«é˜»å¡çš„æ—¶é—´è¿‡é•¿ï¼Œæ— æ³•ä½œå‡ºè¾“å…¥å“åº”\r\n * CLS (ç´¯ç§¯å¸ƒå±€åç§»)æµ‹é‡è§†è§‰ç¨³å®šæ€§çš„ä¸€ä¸ªä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„é‡è¦æŒ‡æ ‡ï¼Œå› ä¸ºè¯¥é¡¹æŒ‡æ ‡æœ‰åŠ©äºé‡åŒ–ç”¨æˆ·ç»å†æ„å¤–å¸ƒå±€åç§»çš„é¢‘ç‡ï¼Œè¾ƒä½çš„ CLS æœ‰åŠ©äºç¡®ä¿ä¸€ä¸ªé¡µé¢æ˜¯ä»¤äººæ„‰æ‚¦çš„\r\n * \r\n */\r\nconst fcpScore = [1000, 2500];\r\nconst lcpScore = [2500, 4000];\r\nconst fidcore = [100, 300];\r\nconst clsScore = [0.1, 0.25];\r\nconst tbtScore = [300, 600];\r\n\r\nexport const webVitalsScore: Record<string, number[]> = {\r\n    fp: fcpScore,\r\n    fcp: fcpScore,\r\n    lcp: lcpScore,\r\n    lcpFinal: lcpScore,\r\n    fid: fidcore,\r\n    fidVitals: fidcore,\r\n    cls: clsScore,\r\n    clsFinal: clsScore,\r\n    tbt: tbtScore,\r\n    tbt5S: tbtScore,\r\n    tbt10S: tbtScore,\r\n    tbtFinal: tbtScore,\r\n};\r\n\r\nexport const getVitalsScore = (\r\n    measureName: string,\r\n    value: IYidengData\r\n  ): IVitalsScore => {\r\n    if (!webVitalsScore[measureName]) {\r\n      return null;\r\n    }\r\n    if (value <= webVitalsScore[measureName][0]) {\r\n      return 'good';\r\n    }\r\n    return value <= webVitalsScore[measureName][1] ? 'needsImprovement' : 'poor';  // needsImprovement éœ€è¦æ”¹è¿›   poor è´«ç©·çš„\r\n  };","import { config } from '../config';\r\nimport { getNavigatorInfo } from '../helpers/getNavigatorInfo';\r\nimport { visibility } from '../helpers/onVisibilityChange';\r\nimport { pushTask } from '../helpers/utils';\r\nimport { getVitalsScore } from '../helpers/vitalsScore';\r\n\r\n/**\r\n * Sends the User timing measure to analyticsTracker\r\n * å°†ç”¨æˆ·å®šæ—¶æµ‹é‡å‘é€åˆ°\r\n */\r\n\r\nexport const reportPerf = function (\r\n    measureName: string,//è¢«æµ‹é‡çš„åç§°\r\n    data: any,\r\n    customProperties?: object //å®šåˆ¶å±æ€§\r\n): void {\r\n    pushTask(() => {\r\n        // å½“é¡µé¢è¢«éšè—çš„æ—¶å€™ä¸æŠ¥å‘Šå…·ä½“æ•°æ®ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†å¤„ç†ç”¨æˆ·åˆ‡èµ°ç•Œé¢æ—¶çš„é—®é¢˜\r\n        if ((visibility.isHidden && measureName.indexOf('Final') < 0) || !config.analyticsTracker) {\r\n            return;\r\n        }\r\n        //å°†åº¦é‡å‘é€åˆ°è‡ªå®šä¹‰åˆ†ææœåŠ¡\r\n        config.analyticsTracker({\r\n            metricName: measureName, //æŒ‡æ ‡åç§°\r\n            data,\r\n            eventProperties: customProperties || {}, //äº‹ä»¶å±æ€§\r\n            navigatorInformation: getNavigatorInfo(), //å¯¼èˆªä¿¡æ¯\r\n            vitalsScore: getVitalsScore(measureName, data), //æŒ‡æ ‡åˆ†æ•°\r\n        });\r\n    })\r\n}","import { getDM, getHC, WN } from '../data/constants';\r\nimport { et, sd } from './getNetworkInformation';\r\nimport { getIsLowEndDevice, getIsLowEndExperience } from './isLowEnd';\r\nimport { INavigatorInfo } from '../typings/types';\r\n/**\r\n * å¦‚ä¸‹ä¿¡æ¯æ¥æºäº window.navigator:\r\n * 1. Device Memory  åªè¯»å±æ€§è¿”å›åƒå…†å­—èŠ‚ä¸ºå•ä½çš„å¤§æ¦‚çš„æœºå™¨å†…å­˜\r\n * 2. Hardware Concurency  è¿”å›å¯åœ¨ç”¨æˆ·è®¡ç®—æœºä¸Šè¿è¡Œçº¿ç¨‹çš„é€»è¾‘å¤„ç†å™¨æ•°\r\n * \r\n * Service workers æœ¬è´¨ä¸Šå……å½“ Web åº”ç”¨ç¨‹åºã€æµè§ˆå™¨ä¸ç½‘ç»œï¼ˆå¯ç”¨æ—¶ï¼‰ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ã€‚\r\n * è¿™ä¸ª API æ—¨åœ¨åˆ›å»ºæœ‰æ•ˆçš„ç¦»çº¿ä½“éªŒï¼Œå®ƒä¼šæ‹¦æˆªç½‘ç»œè¯·æ±‚å¹¶æ ¹æ®ç½‘ç»œæ˜¯å¦å¯ç”¨æ¥é‡‡å–é€‚å½“çš„åŠ¨ä½œã€æ›´æ–°æ¥è‡ªæœåŠ¡å™¨çš„çš„èµ„æºã€‚\r\n * å®ƒè¿˜æä¾›å…¥å£ä»¥æ¨é€é€šçŸ¥å’Œè®¿é—®åå°åŒæ­¥ APIã€‚\r\n * \r\n * 3. Status of the service worker:\r\n *     - controlled: a service worker is controlling the page     --service workeræ­£åœ¨æ§åˆ¶é¡µé¢\r\n *     - supported: the browser supports service worker     æµè§ˆå™¨æ”¯æŒservice worker\r\n *     - unsupported: the user's browser does not support service worker   ç”¨æˆ·çš„æµè§ˆå™¨ä¸æ”¯æŒservice worker\r\n */\r\nexport const getNavigatorInfo = function (): INavigatorInfo {\r\n    if (WN) {\r\n        return {\r\n            deviceMemory: getDM() || 0,\r\n            hardwareConcurrency: getHC() || 0,\r\n            serviceWorkerStatus:\r\n                'serviceWorker' in WN\r\n                    ? WN.serviceWorker!.controller\r\n                        ? 'controlled'\r\n                        : 'supported'\r\n                    : 'unsupported',\r\n            isLowEndDevice:getIsLowEndDevice(),\r\n            isLowEndExperience: getIsLowEndExperience(et, sd),\r\n        }\r\n    }\r\n    return {}\r\n}\r\n","import { config } from \"../config\";\r\nimport { reportPerf } from '../data/reportPerf';\r\nimport { roundByTwo } from '../helpers/utils';\r\n\r\nexport const logData = (\r\n    measureName: string,\r\n    metric: any,\r\n    customProperties?: object\r\n): void => {\r\n    Object.keys(metric).forEach((key) => {\r\n        if (typeof metric[key] === 'number') {\r\n            metric[key] = roundByTwo(metric[key]);\r\n        }\r\n    });\r\n    //å°†åº¦é‡å‘é€åˆ°å¤–éƒ¨è·Ÿè¸ªæœåŠ¡\r\n    reportPerf(measureName, metric, customProperties);\r\n}\r\n\r\n/**\r\n * \r\n * å°†åº¦é‡æŒç»­æ—¶é—´åˆ†æ´¾åˆ°å†…éƒ¨æ—¥å¿—å’Œå¤–éƒ¨æ—¶é—´è·Ÿè¸ªæœåŠ¡ä¸­\r\n */\r\n\r\nexport const logMetric = (\r\n    duration: number, //æŒç»­æ—¶é—´\r\n    measureName: string, //æµ‹è¯•åç§°\r\n    customProperties?: object //å®šåˆ¶å±æ€§\r\n): void => {\r\n    const duration2Decimal = roundByTwo(duration); //æŒç»­2åˆ†é’Ÿ\r\n    if (duration2Decimal <= config.maxTime && duration2Decimal >= 0) {\r\n        // ä»å†…éƒ¨æˆ–è€…å¤–éƒ¨çš„æŠ¥å‘Šå·¥å…·æŠ¥å‘ŠæŒ‡æ ‡æ•°æ®\r\n        reportPerf(measureName, duration2Decimal, customProperties);\r\n    }\r\n}\r\n","import { IMetricMap, IYidengDataConsumption } from '../typings/types';\r\n\r\nexport const metrics: IMetricMap = {};\r\nexport const cls = {\r\n    value: 0,\r\n};\r\nexport const fcp = {\r\n    value: 0,\r\n};\r\nexport const lcp = {\r\n    value: 0,\r\n};\r\nexport const fcpEntryName = 'first-contentful-paint'; //é¦–æ¬¡ç»˜åˆ¶\r\nexport const rt: { value: IYidengDataConsumption } = {\r\n    value: {\r\n        beacon: 0,\r\n        css: 0,\r\n        fetch: 0,\r\n        img: 0,\r\n        other: 0,\r\n        script: 0,\r\n        total: 0,\r\n        xmlhttprequest: 0,\r\n    },\r\n};\r\n//ä¸»çº¿ç¨‹æ€»é˜»å¡æ—¶é—´\r\nexport const tbt = {\r\n    value: 0,\r\n};","import { cls } from '../data/metrics';\r\nimport { IPerformanceEntry } from '../typings/types';\r\n/**\r\n * æ£€æµ‹æ–°çš„å¸ƒå±€ç§»ä½äº‹ä»¶å¹¶æ›´æ–° `cumulativeLayoutShiftScore`å˜é‡ã€‚\r\n */\r\n\r\nexport const initLayoutShift = (performanceEntries: IPerformanceEntry[]) => {\r\n    const lastEntry = performanceEntries.pop();\r\n    // ä»…ç»Ÿè®¡æ²¡æœ‰æœ€è¿‘ç”¨æˆ·è¾“å…¥çš„å¸ƒå±€ç§»ä½\r\n    if (lastEntry && !lastEntry.hadRecentInput && lastEntry.value) {\r\n        cls.value += lastEntry.value;\r\n    }\r\n};","import { IPerfObservers } from '../typings/types';\r\n/**\r\n * @remarks æ ¸å¿ƒæ€§èƒ½æ•°æ®æŒ‡æ ‡å¯¹è±¡\r\n * @public\r\n */\r\nexport const perfObservers: IPerfObservers = {};","import { C } from '../data/constants';\r\nimport { perfObservers } from './observeInstances';\r\nimport { IPerformanceObserverType } from '../typings/types';\r\n/**\r\n * PerformanceObserver å¼‚æ­¥è®¢é˜…å°è£…\r\n */\r\n\r\nexport const po = (\r\n    eventType: IPerformanceObserverType,\r\n    cb: (performanceEntries: any[]) => void\r\n): PerformanceObserver | null => {\r\n    try {\r\n        const perfObserver = new PerformanceObserver((entryList) => {\r\n            cb(entryList.getEntries());\r\n        });\r\n        // è®¢é˜…æ—¶é—´æˆ–è€…å¼€å§‹è®¡æ—¶ bufferedä¸ç«‹å³æ‰§è¡Œåœ¨å†…å­˜ä¸­ç•™ä¸‹PerformanceObserverå®ä¾‹\r\n        perfObserver.observe({ type: eventType, buffered: true });\r\n        return perfObserver;\r\n    } catch (e) {\r\n        C.warn('Yideng.js:', e);\r\n    }\r\n    return null;\r\n}\r\n\r\n//æ–­å¼€æµ‹è¯•é€šé“\r\nexport const poDisconnect = (observer: any) => {\r\n    if (perfObservers[observer]) {\r\n        perfObservers[observer].disconnect();\r\n    }\r\n    delete perfObservers[observer];\r\n};","import { logData, logMetric } from '../data/log';\r\nimport { cls, lcp, rt, tbt } from '../data/metrics';\r\nimport { perfObservers } from './observeInstances';\r\nimport { poDisconnect } from './performanceObserver';\r\nimport { PerformanceEventTiming } from '../typings/types';\r\nexport const initFirstInputDelay = (\r\n    performanceEntries: PerformanceEventTiming[]\r\n) => {\r\n    //å–æœ€åçš„ä¸€ä½å³ä¸ºæˆ‘ä»¬å¸Œæœ›æ‰€è·å–çš„æ—¶é—´ç‚¹\r\n    const lastEntry = performanceEntries.pop();\r\n    if (lastEntry) {\r\n        //æ ¸å¿ƒWeb Vitals FIDé€»è¾‘\r\n        // æµ‹é‡è¾“å…¥äº‹ä»¶çš„å»¶è¿Ÿæ“ä½œ\r\n        logMetric(lastEntry.processingStart - lastEntry.startTime, 'fidVitals', {\r\n            performanceEntry: lastEntry,\r\n        });\r\n        // ä¼ ç»Ÿçš„FIDé€»è¾‘\r\n        // æµ‹é‡å¤„ç†ç¬¬ä¸€ä¸ªè¾“å…¥äº‹ä»¶çš„æŒç»­æ—¶é—´\r\n        logMetric(lastEntry.duration, 'fid', {\r\n            performanceEntry: lastEntry,\r\n        });\r\n    }\r\n\r\n    // é”€æ¯å¯¹FIDçš„æ³¨å†Œå›è°ƒ é¿å…è¿‡å¤šçš„è§‚å¯Ÿè€…é€ æˆå†…å­˜æ³„éœ²\r\n    poDisconnect(1);\r\n    //åˆå§‹åŒ–lcp\r\n    logMetric(lcp.value, 'lcp');\r\n\r\n    if (perfObservers[3] && typeof perfObservers[3].takeRecords === 'function') {\r\n        perfObservers[3].takeRecords();\r\n    }\r\n    logMetric(cls.value, 'cls');\r\n    logMetric(tbt.value, 'tbt');\r\n\r\n    //FIDåæœ‰5ç§’å»¶è¿Ÿçš„TBT\r\n    setTimeout(() => {\r\n        logMetric(tbt.value, `tbt5S`);\r\n    }, 5000);\r\n\r\n    //FIDå10ç§’å»¶è¿Ÿçš„TBT\r\n    setTimeout(() => {\r\n        logMetric(tbt.value, `tbt10S`);\r\n        //FIDè¢«æ¿€æ´»ä»¥å10Sçš„æ•´ä½“æ•°æ®æ¶ˆè€—\r\n        logData('dataConsumption', rt.value);\r\n    }, 10000);\r\n}","import { fcp, tbt } from '../data/metrics';\r\nimport { IPerformanceEntry } from '../typings/types';\r\nexport const initTotalBlockingTime = (\r\n    performanceEntries: IPerformanceEntry[]\r\n): void => {\r\n    performanceEntries.forEach((entry) => {\r\n        //ä»fcp -> ttiè·å–é•¿è€—æ—¶ä»»åŠ¡ï¼ˆselfè¡¨ç¤ºè€—æ—¶é•¿ä»»åŠ¡æ¥è‡ªäºæ¸²æŸ“å¸§ï¼‰\r\n        // console.log('ğŸŒ', entry);\r\n        if (entry.name !== 'self' || entry.startTime < fcp.value) {\r\n            return;\r\n        }\r\n        // console.log('ğŸŒ2', entry);\r\n        //https://developer.mozilla.org/zh-CN/docs/Web/API/Long_Tasks_API\r\n        //é•¿è€—æ—¶ä»»åŠ¡æ„å‘³ç€æ‰§è¡Œæ—¶é—´è¶…è¿‡50msçš„\r\n        const blockingTime = entry.duration - 50;\r\n        if (blockingTime > 0) {\r\n            tbt.value += blockingTime;\r\n        }\r\n    });\r\n}","import { IPerformanceEntry } from '../typings/types';\r\nimport { fcp, fcpEntryName, lcp } from '../data/metrics';\r\nimport { po, poDisconnect } from './performanceObserver';\r\nimport { perfObservers } from './observeInstances';\r\nimport { initTotalBlockingTime } from './totalBlockingTime';\r\nimport { logMetric } from '../data/log';\r\nexport const initFirstPaint = (performanceEntries: IPerformanceEntry[]) => {\r\n    performanceEntries.forEach((entry) => {\r\n        if (entry.name === 'first-paint') {\r\n            logMetric(entry.startTime, 'fp');\r\n        } else if (entry.name === fcpEntryName) {\r\n            fcp.value = entry.startTime;\r\n            logMetric(fcp.value, 'fcp');\r\n            perfObservers[4] = po('longtask', initTotalBlockingTime);\r\n            poDisconnect(0);\r\n        }\r\n    });\r\n};\r\n\r\nexport const initLargestContentfulPaint = (\r\n    performanceEntries: IPerformanceEntry[]\r\n) => {\r\n    const lastEntry = performanceEntries.pop();\r\n    if (lastEntry) {\r\n        lcp.value = lastEntry.renderTime || lastEntry.loadTime;\r\n    }\r\n};\r\n\r\nexport const initElementTiming = (performanceEntries: IPerformanceEntry[]) => {\r\n    performanceEntries.forEach((entry) => {\r\n        if (entry.identifier) {\r\n            logMetric(entry.startTime, entry.identifier);\r\n        }\r\n    });\r\n};\r\n","import { config } from '../config';\r\nimport { logData } from '../data/log';\r\nimport { rt } from '../data/metrics';\r\nimport { IPerformanceEntry } from '../typings/types';\r\nexport const initResourceTiming = (performanceEntries: IPerformanceEntry[]) => {\r\n    //console.log('ğŸ¶', performanceEntries);\r\n    performanceEntries.forEach((entry) => {\r\n        //console.log('ğŸ¶', 1);\r\n        if (config.isResourceTiming) {\r\n            logData('resourceTiming', entry);\r\n        }\r\n        if (entry.decodedBodySize && entry.initiatorType) {\r\n            const bodySize = entry.decodedBodySize / 1000;\r\n            rt.value[entry.initiatorType] += bodySize;\r\n            rt.value.total += bodySize;\r\n        }\r\n    });\r\n};","import { config } from \"../config\";\r\nimport { logMetric } from '../data/log';\r\nimport { cls, lcp, tbt } from '../data/metrics';\r\nimport { initLayoutShift } from './cumulativeLayoutShift';\r\nimport { initFirstInputDelay } from './firstInput';\r\nimport { perfObservers } from './observeInstances';\r\nimport {\r\n    initElementTiming,\r\n    initFirstPaint,\r\n    initLargestContentfulPaint,\r\n} from './paint';\r\nimport { po, poDisconnect } from './performanceObserver';\r\nimport { initResourceTiming } from './resourceTiming';\r\nexport const initPerformanceObserver = (): void => {\r\n    console.log('â° æ€§èƒ½æ”¶é›†å¼€å§‹', Math.random());\r\n    perfObservers[0] = po('paint', initFirstPaint);\r\n    perfObservers[1] = po('first-input', initFirstInputDelay);\r\n    perfObservers[2] = po('largest-contentful-paint', initLargestContentfulPaint);\r\n    //æ”¶é›†é¡µé¢å…¨éƒ¨èµ„æºæ€§èƒ½æ•°æ®\r\n    if (config.isResourceTiming) {\r\n        console.log('ğŸ“š æ”¶é›†é¡µé¢æ€§èƒ½æ•°æ®');\r\n        po('resource', initResourceTiming);\r\n    }\r\n    perfObservers[3] = po('layout-shift', initLayoutShift);\r\n    if (config.isElementTiming) {\r\n        po('element', initElementTiming);\r\n    }\r\n};\r\n\r\nexport const disconnectPerfObserversHidden = (): void => {\r\n    if (perfObservers[2]) {\r\n        logMetric(lcp.value, `lcpFinal`);\r\n        poDisconnect(2);\r\n    }\r\n    if (perfObservers[3]) {\r\n        if (typeof perfObservers[3].takeRecords === 'function') {\r\n            perfObservers[3].takeRecords();\r\n        }\r\n        logMetric(cls.value, `clsFinal`);\r\n        poDisconnect(3);\r\n    }\r\n    if (perfObservers[4]) {\r\n        logMetric(tbt.value, `tbtFinal`);\r\n        poDisconnect(4);\r\n    }\r\n};","import { logData } from './log';\r\nimport { convertToKB } from '../helpers/utils';\r\n/**\r\n * StorageManageræ¥å£çš„estimateï¼ˆï¼‰æ–¹æ³•è¯¢é—®Storage Manageråº”ç”¨ç¨‹åºå ç”¨çš„å­˜å‚¨ç©ºé—´ï¼ˆä½¿ç”¨é‡ï¼‰å’Œå¯ç”¨ç©ºé—´ï¼ˆé…é¢ï¼‰ã€‚\r\n */\r\n\r\nexport const reportStorageEstimate = (storageInfo: StorageEstimate) => {\r\n    const estimateUsageDetails =\r\n        'usageDetails' in storageInfo ? (storageInfo as any).usageDetails : {};\r\n    logData('storageEstimate', {\r\n        quota: convertToKB((storageInfo as any).quota),\r\n        usage: convertToKB((storageInfo as any).usage),\r\n        caches: convertToKB(estimateUsageDetails.caches),\r\n        indexedDB: convertToKB(estimateUsageDetails.indexedDB),\r\n        serviceWorker: convertToKB(estimateUsageDetails.serviceWorkerRegistrations),\r\n    });\r\n};","/**\r\n * ä¸€æ¬¾å…è´¹çš„å¼€æºæ€§èƒ½ç›‘æ§SDK\r\n * ç›®å‰èƒ½å¤Ÿå®Œæˆç›‘æ§çš„æŒ‡æ ‡åŒ…å«FCPç­‰\r\n * \r\n */\r\nimport { config } from './config';\r\nimport { IReportData, IYidengOptions } from './typings/types';\r\nimport ReportData from './data/reportData';\r\nimport analyticsTracker from './data/analyticsTracker';\r\nimport ErrorTrace from './error';\r\nimport { isPerformanceSupported } from './tools/isSupported';\r\nimport { getNavigationTiming } from './performance/getNavigationTiming';\r\nimport { D, W, WN, WP } from './data/constants';\r\nimport {\r\n    disconnectPerfObserversHidden,\r\n    initPerformanceObserver,\r\n} from './performance/observe';\r\nimport { didVisibilityChange } from './helpers/onVisibilityChange';\r\nimport { logData } from './data/log';\r\nimport { getNetworkInformation } from './helpers/getNetworkInformation';\r\nimport { reportStorageEstimate } from './data/storageEstimate';\r\nexport default class collectInfo {\r\n    private v = '1.0.0';\r\n    private reportData: IReportData;\r\n    constructor(options: IYidengOptions = { permaceUrl: '', rrwebUrl: '', module: \"\" }) {\r\n        // æ‰©å±•åŸºç¡€é…ç½®\r\n        const logUrl = options.logUrl; //æ•°æ®ä¸ŠæŠ¥æœåŠ¡åœ°å€\r\n        const rrwebUrl = options.rrwebUrl;\r\n        const permaceUrl = options.rrwebUrl;\r\n        if (!logUrl) {\r\n            throw new Error(`å°çŸ³å¤´ç³»ç»Ÿç›‘æ§å¹³å°${this.v}æç¤ºæœªä¼ é€’ä¸ŠæŠ¥æœåŠ¡åœ°å€`);\r\n        }\r\n        //å‘åå°è¾“é€æ•°æ®\r\n        const insReportData = new ReportData({\r\n            logUrl,\r\n        });\r\n        config.reportData = insReportData;\r\n        //å¯¹å¤–æš´éœ²ä¸Šä¼ æ¥å£\r\n        this.reportData = insReportData;\r\n        //é›†åˆæ•°æ®æ±‡æ€»\r\n        const _analyticsTracker = options.analyticsTracker;\r\n        if (_analyticsTracker) {\r\n            config.analyticsTracker = _analyticsTracker; //è‹¥ç”¨æˆ·ä¼ å…¥åˆ†æå™¨ï¼Œåˆ™ä½¿ç”¨ç”¨æˆ·çš„åˆ†æå™¨\r\n        } else {\r\n            config.analyticsTracker = analyticsTracker;\r\n        }\r\n        config.isResourceTiming = !!options.resourceTiming;\r\n        config.isElementTiming = !!options.elementTiming;\r\n        config.maxTime = options.maxMeasureTime || config.maxTime;\r\n        config.isRrweb = options.isRrweb || config.isRrweb;\r\n        config.rrwebUrl = options.rrwebUrl || config.rrwebUrl;\r\n        config.permaceUrl = options.permaceUrl || config.permaceUrl;\r\n        config.logUrl = options.logUrl || config.logUrl;\r\n        config.module = options.module || config.module;\r\n        if (options.captureError) {\r\n            //å¼€å¯é”™è¯¯è·Ÿè¸ª\r\n            const errorTrace = new ErrorTrace();\r\n            errorTrace.run();\r\n        }\r\n\r\n        //å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒæ€§èƒ½æŒ‡æ ‡åªèƒ½æ”¾å¼ƒ\r\n        if (!isPerformanceSupported()) {\r\n            return;\r\n        }\r\n\r\n        //æµè§ˆå™¨æ”¯æŒçš„èµ·FRPè¿™æ ·çš„Observerç»Ÿè®¡æ€§èƒ½\r\n        if ('PerformanceObserver' in W) {\r\n            initPerformanceObserver();\r\n        }\r\n        //åˆå§‹åŒ–\r\n        if (typeof D.hidden !== 'undefined') {\r\n            //Opera 12.10å’ŒFirefox 18åŠæ›´é«˜ç‰ˆæœ¬æ”¯æŒ\r\n            D.addEventListener(\r\n                'visibilitychange',\r\n                didVisibilityChange.bind(this, disconnectPerfObserversHidden)\r\n            );\r\n        }\r\n        //è®°å½•ç³»ç»ŸDNSè¯·æ±‚+ç™½å±æ—¶é—´ç­‰\r\n        logData('navigationTiming', getNavigationTiming());\r\n        //è®°å½•ç”¨æˆ·çš„ç½‘é€Ÿ H5+å¤šæ™®å‹’æµ‹é€Ÿ\r\n        logData('networkInformation', getNetworkInformation());\r\n        //ç®¡ç†ç¦»çº¿ç¼“å­˜æ•°æ®\r\n        if (WN && WN.storage && typeof WN.storage.estimate === 'function') {\r\n            WN.storage.estimate().then(reportStorageEstimate);\r\n        }\r\n    }\r\n}","import { W, WP } from '../data/constants';\r\n/**\r\n * å¦‚æœæµè§ˆå™¨æ”¯æŒNavigation Timing APIï¼Œåˆ™ä¸ºTrue\r\n * ç”¨æˆ·è®¡æ—¶APIå’ŒPerformanceObserveræ¥å£\r\n * åœ¨Safariä¸­ï¼Œç”¨æˆ·è®¡æ—¶APIï¼ˆperformance.markï¼ˆï¼‰ï¼‰ä¸å¯ç”¨\r\n * å› æ­¤ï¼ŒDevToolsæ—¶é—´çº¿ä¸ä¼šç”¨æ ‡è®°è¿›è¡Œæ³¨é‡Šã€‚\r\n * å¼€å‘è€…ï¼šdeveloper.mozilla.org/en-US/docs/Web/API/Performance/mark\r\n *         developer.mozilla.org/en-US/docs/Web/API/PerformanceObserver\r\n *         developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByType\r\n */\r\nexport const isPerformanceSupported = (): boolean => {\r\n    return WP && !!WP.getEntriesByType && !!WP.now && !!WP.mark;\r\n};","import { WP } from '../data/constants';\r\nimport { isPerformanceSupported } from '../helpers/isSupported';\r\nimport { IYidengNavigationTiming } from '../typings/types';\r\n/**\r\n * Navigation Timing API provides performance metrics for HTML documents.\r\n * Navigation Timing APIä¸ºHTMLæ–‡æ¡£æä¾›äº†æ€§èƒ½æŒ‡æ ‡ã€‚\r\n * w3c.github.io/navigation-timing/\r\n * developers.google.com/web/fundamentals/performance/navigation-and-resource-timing\r\n */\r\n\r\nexport const getNavigationTiming = (): IYidengNavigationTiming => {\r\n    if (!isPerformanceSupported()) {\r\n        return {};\r\n    }\r\n    // There is an open issue to type correctly getEntriesByType\r\n    // github.com/microsoft/TypeScript/issues/33866\r\n    // è¿™é‡Œç›´æ¥çš„ç‰©ç†èµ‹å€¼performance.timing å·²è¢«å¼ƒç”¨\r\n    const n = WP.getEntriesByType('navigation')[0] as any;\r\n    // In Safari version 11.2 Navigation Timing isn't supported yet\r\n    if (!n) {\r\n        return {};\r\n    }\r\n    const responseStart = n.responseStart;\r\n    const responseEnd = n.responseEnd;\r\n    //æˆ‘ä»¬ç¼“å­˜navigation timeä»¥å¤‡å°†æ¥ä½¿ç”¨\r\n    return {\r\n        // fetchStart marks when the browser starts to fetch a resource\r\n        // æµè§ˆå™¨å¼€å§‹è·å–èµ„æºæ—¶çš„fetchStartæ ‡è®°\r\n        // responseEnd is when the last byte of the response arrives\r\n        // responseEndæ˜¯å“åº”çš„æœ€åä¸€ä¸ªå­—èŠ‚åˆ°è¾¾çš„æ—¶é—´\r\n        fetchTime: responseEnd - n.fetchStart,\r\n        // Service worker time plus response time\r\n        // Service workeræ—¶é—´åŠ ä¸Šå“åº”æ—¶é—´\r\n        workerTime: n.workerStart > 0 ? responseEnd - n.workerStart : 0,\r\n        // Request plus response time (network only)\r\n        // è¯·æ±‚åŠ ä¸Šå“åº”æ—¶é—´ï¼ˆä»…é™ç½‘ç»œï¼‰\r\n        totalTime: responseEnd - n.requestStart,\r\n        // Response time only (download)\r\n        // ä»…å“åº”æ—¶é—´ï¼ˆä¸‹è½½ï¼‰\r\n        downloadTime: responseEnd - responseStart,\r\n        // Time to First Byte (TTFB)\r\n        // åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ï¼ˆTTFBï¼‰\r\n        timeToFirstByte: responseStart - n.requestStart,\r\n        // HTTP header size\r\n        // HTTPå¤´å¤§å°\r\n        headerSize: n.transferSize - n.encodedBodySize || 0,\r\n        //DNSè§£ææ—¶é—´\r\n        dnsLookupTime: n.domainLookupEnd - n.domainLookupStart,\r\n        //TCPå»ºç«‹æ—¶é—´\r\n        tcpTime: n.connectEnd - n.connectStart || 0,\r\n        // ç™½å±æ—¶é—´\r\n        whiteTime: n.responseStart - n.navigationStart || 0,\r\n        //domæ¸²æŸ“å®Œæˆæ—¶é—´\r\n        domTime: n.domContentLoadedEventEnd - n.navigationStart || 0,\r\n        //é¡µé¢onloadæ—¶é—´\r\n        loadTime: n.loadEventEnd - n.navigationStart || 0,\r\n        //é¡µé¢è§£ædomè€—æ—¶\r\n        parseDomTime: n.domComplete - n.domInteractive || 0,\r\n    };\r\n};","import { W, WP } from '../data/constants';\r\n/**\r\n * True if the browser supports the Navigation Timing API,\r\n * User Timing API and the PerformanceObserver Interface.\r\n * In Safari, the User Timing API (performance.mark()) is not available,\r\n * so the DevTools timeline will not be annotated with marks.\r\n * Support: developer.mozilla.org/en-US/docs/Web/API/Performance/mark\r\n * Support: developer.mozilla.org/en-US/docs/Web/API/PerformanceObserver\r\n * Support: developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByType\r\n * \r\n * getEntriesByType  å¯ä»¥é€šè¿‡åœ¨æ˜¾å¼æ—¶é—´ç‚¹è¿›è¡Œæ€§èƒ½æ ‡è®°æˆ–åº¦é‡ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡è°ƒç”¨markï¼ˆï¼‰æ–¹æ³•ï¼‰æ¥åˆ›å»ºåˆ—è¡¨çš„æˆå‘˜ï¼ˆæ¡ç›®ï¼‰ã€‚\r\n * PerformanceObserver() æ„é€ å‡½æ•°ä½¿ç”¨ç»™å®šçš„è§‚å¯Ÿè€… callback ç”Ÿæˆä¸€ä¸ªæ–°çš„ PerformanceObserver å¯¹è±¡.å½“é€šè¿‡ observe() æ–¹æ³•æ³¨å†Œçš„ æ¡ç›®ç±»å‹ çš„ æ€§èƒ½æ¡ç›®äº‹ä»¶ è¢«è®°å½•ä¸‹æ¥æ—¶,è°ƒç”¨è¯¥è§‚å¯Ÿè€…å›è°ƒ\r\n */\r\nexport const isPerformanceSupported = (): boolean => {\r\n    return WP && !!WP.getEntriesByType && !!WP.now && !!WP.mark;\r\n};"],"names":["AskPriority","W","window","C","console","D","document","WN","navigator","WP","performance","getDM","deviceMemory","getHC","hardwareConcurrency","ReportData","options","logUrl","Error","this","sendToAnalytics","level","body","url","logurl","URGENT","fetch","headers","module","config","toString","method","keepalive","xhr","XMLHttpRequest","setRequestHeader","send","onload","e","IDLE","sendBeacon","img","Image","src","reportData","isResourceTiming","isElementTiming","maxTime","isRrweb","rrwebUrl","permaceUrl","analyticsTracker","ErrorTrace","errordefo","eventsMatrix","globalError","onerror","eventOrMessage","scriptURL","lineno","colno","error","errorInfo","JSON","stringify","events","len","_this","length","concat","recordPage","networkError","addEventListener","target","log","promiseError","preventDefault","reason","iframeError","frames","i","consoleReflect","record","emit","event","isCheckout","push","checkoutEveryNth","packFn","pack","run","et","sd","getIsLowEndDevice","getIsLowEndExperience","visibility","isHidden","didVisibilityChange","cb","hidden","roundByTwo","num","parseFloat","toFixed","convertToKB","bytes","Math","pow","fcpScore","lcpScore","fidcore","clsScore","tbtScore","webVitalsScore","fp","fcp","lcp","lcpFinal","fid","fidVitals","cls","clsFinal","tbt","tbt5S","tbt10S","tbtFinal","getVitalsScore","measureName","value","reportPerf","data","customProperties","indexOf","metricName","eventProperties","navigatorInformation","serviceWorkerStatus","serviceWorker","controller","isLowEndDevice","isLowEndExperience","vitalsScore","requestIdleCallback","timeout","logData","metric","Object","keys","forEach","key","logMetric","duration","duration2Decimal","rt","beacon","css","other","script","total","xmlhttprequest","initLayoutShift","performanceEntries","lastEntry","pop","hadRecentInput","perfObservers","po","eventType","perfObserver","PerformanceObserver","entryList","getEntries","observe","type","buffered","warn","poDisconnect","observer","disconnect","initFirstInputDelay","processingStart","startTime","performanceEntry","takeRecords","setTimeout","initTotalBlockingTime","entry","name","blockingTime","initFirstPaint","initLargestContentfulPaint","renderTime","loadTime","initElementTiming","identifier","initResourceTiming","decodedBodySize","initiatorType","bodySize","disconnectPerfObserversHidden","reportStorageEstimate","storageInfo","estimateUsageDetails","usageDetails","quota","usage","caches","indexedDB","serviceWorkerRegistrations","v","insReportData","resourceTiming","elementTiming","maxMeasureTime","captureError","getEntriesByType","now","mark","random","bind","n","responseStart","responseEnd","fetchTime","fetchStart","workerTime","workerStart","totalTime","requestStart","downloadTime","timeToFirstByte","headerSize","transferSize","encodedBodySize","dnsLookupTime","domainLookupEnd","domainLookupStart","tcpTime","connectEnd","connectStart","whiteTime","navigationStart","domTime","domContentLoadedEventEnd","loadEventEnd","parseDomTime","domComplete","domInteractive","getNavigationTiming","dataConnection","connection","effectiveType","saveData","downlink","rtt","getNetworkInformation","storage","estimate","then"],"mappings":"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"}